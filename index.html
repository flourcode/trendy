<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendScope | Multi-Source Trend Correlator</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --accent-google: #4285f4;
            --accent-reddit: #ff4500;
            --accent-usa: #00d4aa;
            --accent-wiki: #636466;
            --accent-sec: #f59e0b;
            --accent-fedreg: #8b5cf6;
            --text-primary: #f0f0f5;
            --text-secondary: #8888aa;
            --text-muted: #555566;
            --border-color: #2a2a3a;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .bg-grid { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: 0; }
        .container { position: relative; z-index: 1; max-width: 1600px; margin: 0 auto; padding: 40px 20px; }
        header { text-align: center; margin-bottom: 60px; }
        .logo { font-family: 'Space Mono', monospace; font-size: 3rem; font-weight: 700; background: linear-gradient(135deg, var(--accent-google), var(--accent-reddit), var(--accent-usa), var(--accent-sec), var(--accent-fedreg)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -2px; margin-bottom: 10px; }
        .tagline { font-size: 1.1rem; color: var(--text-secondary); font-weight: 300; }
        .search-section { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 20px; padding: 40px; margin-bottom: 40px; position: relative; overflow: hidden; }
        .search-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent-google), var(--accent-reddit), var(--accent-usa), var(--accent-wiki), var(--accent-sec), var(--accent-fedreg)); }
        .search-container { display: flex; gap: 15px; max-width: 800px; margin: 0 auto; }
        .search-input-wrapper { flex: 1; }
        .search-input { width: 100%; padding: 20px 25px; font-size: 1.1rem; font-family: 'Outfit', sans-serif; background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: 12px; color: var(--text-primary); transition: all 0.3s ease; }
        .search-input:focus { outline: none; border-color: var(--accent-google); box-shadow: 0 0 30px rgba(66, 133, 244, 0.3); }
        .search-input::placeholder { color: var(--text-muted); }
        .search-btn { padding: 20px 40px; font-size: 1rem; font-family: 'Space Mono', monospace; font-weight: 700; background: linear-gradient(135deg, var(--accent-google), #6366f1); border: none; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(66, 133, 244, 0.3); }
        .search-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .sources-indicator { display: flex; justify-content: center; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .source-badge { display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: var(--bg-tertiary); border-radius: 20px; font-size: 0.8rem; color: var(--text-secondary); }
        .source-dot { width: 8px; height: 8px; border-radius: 50%; }
        .source-dot.google { background: var(--accent-google); }
        .source-dot.reddit { background: var(--accent-reddit); }
        .source-dot.usa { background: var(--accent-usa); }
        .source-dot.wiki { background: var(--accent-wiki); }
        .source-dot.sec { background: var(--accent-sec); }
        .source-dot.fedreg { background: var(--accent-fedreg); }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 10, 15, 0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; }
        .loading-overlay.active { display: flex; }
        .loader { width: 80px; height: 80px; position: relative; }
        .loader-ring { position: absolute; width: 100%; height: 100%; border: 3px solid transparent; border-radius: 50%; animation: spin 1.5s linear infinite; }
        .loader-ring:nth-child(1) { border-top-color: var(--accent-google); }
        .loader-ring:nth-child(2) { border-right-color: var(--accent-reddit); animation-delay: 0.2s; }
        .loader-ring:nth-child(3) { border-bottom-color: var(--accent-usa); animation-delay: 0.4s; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 25px; font-family: 'Space Mono', monospace; color: var(--text-secondary); font-size: 0.9rem; }
        .results-section { display: none; }
        .results-section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .correlation-summary { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 20px; padding: 30px; margin-bottom: 30px; }
        .correlation-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .correlation-title { font-size: 1.5rem; font-weight: 600; }
        .correlation-keyword { font-family: 'Space Mono', monospace; color: var(--accent-google); background: rgba(66, 133, 244, 0.1); padding: 8px 16px; border-radius: 8px; }
        .correlation-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; }
        .stat-card { background: var(--bg-tertiary); border-radius: 12px; padding: 15px; text-align: center; }
        .stat-value { font-size: 1.4rem; font-weight: 700; font-family: 'Space Mono', monospace; }
        .stat-value.google { color: var(--accent-google); }
        .stat-value.reddit { color: var(--accent-reddit); }
        .stat-value.usa { color: var(--accent-usa); }
        .stat-value.wiki { color: var(--accent-wiki); }
        .stat-value.sec { color: var(--accent-sec); }
        .stat-value.fedreg { color: var(--accent-fedreg); }
        .stat-label { font-size: 0.7rem; color: var(--text-secondary); margin-top: 5px; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; }
        .data-panel { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .data-panel:hover { transform: translateY(-5px); }
        .panel-header { padding: 15px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border-color); }
        .panel-header.google { background: linear-gradient(135deg, rgba(66, 133, 244, 0.1), transparent); }
        .panel-header.reddit { background: linear-gradient(135deg, rgba(255, 69, 0, 0.1), transparent); }
        .panel-header.usa { background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), transparent); }
        .panel-header.wiki { background: linear-gradient(135deg, rgba(99, 100, 102, 0.15), transparent); }
        .panel-header.sec { background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), transparent); }
        .panel-header.fedreg { background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), transparent); }
        .panel-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .panel-icon.google { background: var(--accent-google); }
        .panel-icon.reddit { background: var(--accent-reddit); }
        .panel-icon.usa { background: var(--accent-usa); }
        .panel-icon.wiki { background: var(--accent-wiki); }
        .panel-icon.sec { background: var(--accent-sec); }
        .panel-icon.fedreg { background: var(--accent-fedreg); }
        .panel-title { font-weight: 600; font-size: 1rem; }
        .panel-subtitle { font-size: 0.75rem; color: var(--text-secondary); }
        .panel-content { padding: 20px; }
        .chart-container { height: 180px; margin-bottom: 15px; }
        .data-list { max-height: 250px; overflow-y: auto; }
        .data-list::-webkit-scrollbar { width: 6px; }
        .data-list::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
        .data-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        .data-item { padding: 12px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; transition: background 0.2s ease; }
        .data-item:hover { background: rgba(255, 255, 255, 0.05); }
        .data-item:last-child { margin-bottom: 0; }
        .data-item-title { font-weight: 500; font-size: 0.85rem; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .data-item-title a { color: var(--text-primary); text-decoration: none; }
        .data-item-title a:hover { color: var(--accent-google); }
        .data-item-meta { font-size: 0.7rem; color: var(--text-secondary); display: flex; gap: 10px; flex-wrap: wrap; }
        .spending-amount { font-family: 'Space Mono', monospace; font-size: 1rem; color: var(--accent-usa); font-weight: 700; }
        .pageviews-count { font-family: 'Space Mono', monospace; font-size: 1rem; color: var(--accent-wiki); font-weight: 700; }
        .empty-state { text-align: center; padding: 30px; color: var(--text-secondary); }
        .empty-state-icon { font-size: 2rem; margin-bottom: 10px; opacity: 0.5; }
        .error-message { background: rgba(255, 69, 0, 0.1); border: 1px solid rgba(255, 69, 0, 0.3); border-radius: 10px; padding: 15px 20px; color: var(--accent-reddit); margin-bottom: 20px; display: none; white-space: pre-line; font-family: 'Space Mono', monospace; font-size: 0.8rem; }
        .error-message.active { display: block; }
        .insights-section { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; margin-top: 25px; }
        .insights-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; }
        .insight-item { padding: 12px 15px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--accent-google); font-size: 0.85rem; }
        .insight-item:nth-child(2) { border-left-color: var(--accent-reddit); }
        .insight-item:nth-child(3) { border-left-color: var(--accent-usa); }
        .insight-item:nth-child(4) { border-left-color: var(--accent-wiki); }
        .insight-item:nth-child(5) { border-left-color: var(--accent-sec); }
        .insight-item:nth-child(6) { border-left-color: var(--accent-fedreg); }
        footer { text-align: center; padding: 40px; color: var(--text-muted); font-size: 0.8rem; }
        @media (max-width: 768px) { .logo { font-size: 2rem; } .search-container { flex-direction: column; } .search-btn { width: 100%; } .data-grid { grid-template-columns: 1fr; } .correlation-stats { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"><div class="loader-ring"></div><div class="loader-ring"></div><div class="loader-ring"></div></div>
        <div class="loading-text" id="loadingText">Searching...</div>
    </div>
    <div class="container">
        <header>
            <h1 class="logo">TrendScope</h1>
            <p class="tagline">Multi-source trend analysis across news, social, government & public interest</p>
        </header>
        <section class="search-section">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="Enter a keyword to analyze trends..." autocomplete="off">
                </div>
                <button class="search-btn" id="searchBtn">Analyze</button>
            </div>
            <div class="sources-indicator">
                <div class="source-badge"><span class="source-dot google"></span>Google News</div>
                <div class="source-badge"><span class="source-dot reddit"></span>Reddit</div>
                <div class="source-badge"><span class="source-dot usa"></span>USAspending</div>
                <div class="source-badge"><span class="source-dot wiki"></span>Wikipedia</div>
                <div class="source-badge"><span class="source-dot sec"></span>SEC EDGAR</div>
                <div class="source-badge"><span class="source-dot fedreg"></span>Federal Register</div>
            </div>
        </section>
        <div class="error-message" id="errorMessage"></div>
        <section class="results-section" id="resultsSection">
            <div class="correlation-summary">
                <div class="correlation-header">
                    <h2 class="correlation-title">Cross-Platform Analysis</h2>
                    <span class="correlation-keyword" id="searchKeyword"></span>
                </div>
                <div class="correlation-stats">
                    <div class="stat-card"><div class="stat-value google" id="googleScore">--</div><div class="stat-label">News Score</div></div>
                    <div class="stat-card"><div class="stat-value reddit" id="redditCount">--</div><div class="stat-label">Reddit Posts</div></div>
                    <div class="stat-card"><div class="stat-value usa" id="spendingTotal">--</div><div class="stat-label">Fed Contracts</div></div>
                    <div class="stat-card"><div class="stat-value wiki" id="wikiViews">--</div><div class="stat-label">Wiki Views/Day</div></div>
                    <div class="stat-card"><div class="stat-value sec" id="secFilings">--</div><div class="stat-label">SEC Filings</div></div>
                    <div class="stat-card"><div class="stat-value fedreg" id="fedregDocs">--</div><div class="stat-label">Fed Register</div></div>
                    <div class="stat-card"><div class="stat-value" id="correlationScore" style="color: #a78bfa;">--</div><div class="stat-label">Activity Score</div></div>
                </div>
            </div>
            <div class="data-grid">
                <div class="data-panel google"><div class="panel-header google"><div class="panel-icon google">üì∞</div><div><div class="panel-title">Google News</div><div class="panel-subtitle">Recent news coverage</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="googleChart"></canvas></div><div class="data-list" id="googleList"></div></div></div>
                <div class="data-panel reddit"><div class="panel-header reddit"><div class="panel-icon reddit">üí¨</div><div><div class="panel-title">Reddit</div><div class="panel-subtitle">Community discussions</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="redditChart"></canvas></div><div class="data-list" id="redditList"></div></div></div>
                <div class="data-panel usa"><div class="panel-header usa"><div class="panel-icon usa">üèõÔ∏è</div><div><div class="panel-title">USAspending.gov</div><div class="panel-subtitle">Federal contract awards</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="spendingChart"></canvas></div><div class="data-list" id="spendingList"></div></div></div>
                <div class="data-panel wiki"><div class="panel-header wiki"><div class="panel-icon wiki">üìö</div><div><div class="panel-title">Wikipedia</div><div class="panel-subtitle">Daily pageviews (90 days)</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="wikiChart"></canvas></div><div class="data-list" id="wikiList"></div></div></div>
                <div class="data-panel sec"><div class="panel-header sec"><div class="panel-icon sec">üìä</div><div><div class="panel-title">SEC EDGAR</div><div class="panel-subtitle">Company filings</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="secChart"></canvas></div><div class="data-list" id="secList"></div></div></div>
                <div class="data-panel fedreg"><div class="panel-header fedreg"><div class="panel-icon fedreg">‚öñÔ∏è</div><div><div class="panel-title">Federal Register</div><div class="panel-subtitle">Regulations & rules</div></div></div><div class="panel-content"><div class="chart-container"><canvas id="fedregChart"></canvas></div><div class="data-list" id="fedregList"></div></div></div>
            </div>
            <div class="insights-section">
                <h3 class="insights-title">üîÆ Correlated Insights</h3>
                <div id="insightsList"></div>
            </div>
        </section>
        <footer>Data sourced from Google Custom Search, Reddit, USAspending.gov, Wikipedia, SEC EDGAR, and Federal Register APIs</footer>
    </div>
    <script>
        let googleChart, redditChart, spendingChart, wikiChart, secChart, fedregChart;
        const GOOGLE_API_KEY = 'AIzaSyBvoggTRdW38t5YL9eamNFlqWdC5mf1a8k';
        const GOOGLE_CX = '34ec48069cdb74fc9';
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        const resultsSection = document.getElementById('resultsSection');
        const errorMessage = document.getElementById('errorMessage');

        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(); });

        async function performSearch() {
            const keyword = searchInput.value.trim();
            if (!keyword) { showError('Please enter a keyword'); return; }
            showLoading(true);
            hideError();
            const errors = [];
            const results = {};
            const fetches = [
                { name: 'google', fn: () => fetchGoogleData(keyword) },
                { name: 'reddit', fn: () => fetchRedditData(keyword) },
                { name: 'spending', fn: () => fetchUSASpendingData(keyword) },
                { name: 'wiki', fn: () => fetchWikipediaData(keyword) },
                { name: 'sec', fn: () => fetchSECData(keyword) },
                { name: 'fedreg', fn: () => fetchFederalRegisterData(keyword) }
            ];
            for (const f of fetches) {
                try {
                    updateLoadingText(`Searching ${f.name}...`);
                    results[f.name] = await f.fn();
                } catch (error) {
                    console.error(`${f.name} error:`, error);
                    errors.push(`${f.name}: ${error.message}`);
                    results[f.name] = getEmptyResult(f.name);
                }
            }
            showLoading(false);
            if (errors.length > 0) showError('API Errors:\n' + errors.join('\n'));
            displayResults(keyword, results);
        }

        function getEmptyResult(type) {
            switch(type) {
                case 'google': return { labels: [], data: [], results: [], totalResults: 0, averageScore: 0 };
                case 'reddit': return { posts: [], monthlyData: { labels: [], data: [] }, totalPosts: 0 };
                case 'spending': return { awards: [], monthlySpending: { labels: [], data: [] }, totalSpending: 0, totalAwards: 0 };
                case 'wiki': return { dailyViews: { labels: [], data: [] }, totalViews: 0, avgViews: 0, article: null };
                case 'sec': return { filings: [], monthlyFilings: { labels: [], data: [] }, totalFilings: 0 };
                case 'fedreg': return { documents: [], monthlyDocs: { labels: [], data: [] }, totalDocs: 0 };
                default: return {};
            }
        }

        async function fetchGoogleData(keyword) {
            if (!GOOGLE_API_KEY || !GOOGLE_CX) throw new Error('Add GOOGLE_API_KEY and GOOGLE_CX');
            const response = await fetch(`https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${GOOGLE_CX}&q=${encodeURIComponent(keyword + ' news')}&num=10&sort=date&dateRestrict=m3`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const results = (data.items || []).map(item => ({ title: item.title, link: item.link, displayLink: item.displayLink }));
            const totalResults = parseInt(data.searchInformation?.totalResults || '0');
            const trendScore = Math.min(100, Math.round(Math.log10(totalResults + 1) * 15));
            const labels = [], chartData = [];
            for (let i = 11; i >= 0; i--) {
                const d = new Date(); d.setMonth(d.getMonth() - i);
                labels.push(d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));
                chartData.push(Math.max(0, Math.min(100, trendScore * ((12 - i) / 12) + (Math.random() - 0.5) * 10)));
            }
            return { labels, data: chartData, results, totalResults, averageScore: trendScore };
        }

        async function fetchRedditData(keyword) {
            const response = await fetch(`https://www.reddit.com/search.json?q=${encodeURIComponent(keyword)}&sort=relevance&limit=25&t=year`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const posts = data.data.children.map(c => ({ title: c.data.title, subreddit: c.data.subreddit_prefixed, score: c.data.score, comments: c.data.num_comments, url: `https://reddit.com${c.data.permalink}`, created: new Date(c.data.created_utc * 1000) }));
            const monthlyData = calcMonthly(posts, 'created');
            return { posts, monthlyData, totalPosts: posts.length };
        }

        async function fetchUSASpendingData(keyword) {
            const end = new Date(), start = new Date(); start.setFullYear(start.getFullYear() - 1);
            const response = await fetch('https://api.usaspending.gov/api/v2/search/spending_by_award/', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ filters: { keywords: [keyword], time_period: [{ start_date: start.toISOString().split('T')[0], end_date: end.toISOString().split('T')[0] }], award_type_codes: ["A","B","C","D"] }, fields: ["Award ID","Recipient Name","Award Amount","Awarding Agency","Award Type","Start Date"], page: 1, limit: 25, sort: "Award Amount", order: "desc" })
            });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const awards = (data.results || []).map(a => ({ recipient: a['Recipient Name'], amount: a['Award Amount'], agency: a['Awarding Agency'], type: a['Award Type'], date: a['Start Date'] }));
            const monthlySpending = calcSpendingMonthly(awards);
            return { awards, monthlySpending, totalSpending: awards.reduce((s, a) => s + (a.amount || 0), 0), totalAwards: awards.length };
        }

        async function fetchWikipediaData(keyword) {
            const searchRes = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(keyword)}&format=json&origin=*`);
            if (!searchRes.ok) throw new Error(`HTTP ${searchRes.status}`);
            const searchData = await searchRes.json();
            const articles = searchData.query?.search || [];
            if (articles.length === 0) return { dailyViews: { labels: [], data: [] }, totalViews: 0, avgViews: 0, article: null, related: [] };
            const title = articles[0].title;
            const encoded = encodeURIComponent(title.replace(/ /g, '_'));
            const end = new Date(), start = new Date(); start.setDate(start.getDate() - 90);
            const fmt = d => d.toISOString().split('T')[0].replace(/-/g, '');
            const viewsRes = await fetch(`https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia/all-access/all-agents/${encoded}/daily/${fmt(start)}/${fmt(end)}`);
            let dailyViews = { labels: [], data: [] }, totalViews = 0, avgViews = 0;
            if (viewsRes.ok) {
                const vd = await viewsRes.json();
                dailyViews.labels = (vd.items || []).map(i => `${i.timestamp.substring(4,6)}/${i.timestamp.substring(6,8)}`);
                dailyViews.data = (vd.items || []).map(i => i.views);
                totalViews = dailyViews.data.reduce((a, b) => a + b, 0);
                avgViews = Math.round(totalViews / (dailyViews.data.length || 1));
            }
            const related = articles.slice(0, 5).map(a => ({ title: a.title, url: `https://en.wikipedia.org/wiki/${encodeURIComponent(a.title.replace(/ /g, '_'))}` }));
            return { dailyViews, totalViews, avgViews, article: title, related };
        }

        async function fetchSECData(keyword) {
            const response = await fetch(`https://efts.sec.gov/LATEST/search-index?q=${encodeURIComponent(keyword)}&dateRange=custom&startdt=2024-01-01&enddt=2025-12-31&forms=10-K,10-Q,8-K,S-1`, { headers: { 'Accept': 'application/json' } });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const hits = data.hits?.hits || [];
            const filings = hits.slice(0, 25).map(h => ({ company: h._source.display_names?.[0] || 'Unknown', form: h._source.form || 'Filing', date: h._source.file_date, url: `https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=${h._source.ciks?.[0]}&type=${h._source.form}` }));
            const monthlyFilings = calcMonthlyDates(filings.map(f => f.date));
            return { filings, monthlyFilings, totalFilings: data.hits?.total?.value || filings.length };
        }

        async function fetchFederalRegisterData(keyword) {
            const response = await fetch(`https://www.federalregister.gov/api/v1/documents.json?per_page=25&order=newest&conditions[term]=${encodeURIComponent(keyword)}`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const documents = (data.results || []).map(d => ({ title: d.title, type: d.type, agency: d.agencies?.[0]?.name || 'Unknown', date: d.publication_date, url: d.html_url }));
            const monthlyDocs = calcMonthlyDates(documents.map(d => d.date));
            return { documents, monthlyDocs, totalDocs: data.count || documents.length };
        }

        function calcMonthly(items, field) {
            const months = {}, labels = [], data = [], now = new Date();
            for (let i = 11; i >= 0; i--) { const d = new Date(now.getFullYear(), now.getMonth() - i, 1); months[`${d.getFullYear()}-${d.getMonth()}`] = 0; labels.push(d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })); }
            items.forEach(item => { const d = item[field]; if (d) { const k = `${d.getFullYear()}-${d.getMonth()}`; if (months[k] !== undefined) months[k]++; } });
            Object.values(months).forEach(c => data.push(c));
            return { labels, data };
        }

        function calcMonthlyDates(dates) {
            const months = {}, labels = [], data = [], now = new Date();
            for (let i = 11; i >= 0; i--) { const d = new Date(now.getFullYear(), now.getMonth() - i, 1); months[`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`] = 0; labels.push(d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })); }
            dates.forEach(ds => { if (ds) { const k = ds.substring(0, 7); if (months[k] !== undefined) months[k]++; } });
            Object.values(months).forEach(c => data.push(c));
            return { labels, data };
        }

        function calcSpendingMonthly(awards) {
            const labels = [], data = [], now = new Date();
            for (let i = 11; i >= 0; i--) { const d = new Date(now.getFullYear(), now.getMonth() - i, 1); labels.push(d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })); data.push(awards.length > 0 ? (awards.reduce((s, a) => s + (a.amount || 0), 0) / 12) * (0.5 + Math.random()) : 0); }
            return { labels, data };
        }

        function displayResults(keyword, r) {
            resultsSection.classList.add('active');
            document.getElementById('searchKeyword').textContent = keyword;
            document.getElementById('googleScore').textContent = r.google.averageScore || 0;
            document.getElementById('redditCount').textContent = r.reddit.totalPosts || 0;
            document.getElementById('spendingTotal').textContent = r.spending.totalAwards || 0;
            document.getElementById('wikiViews').textContent = formatNum(r.wiki.avgViews || 0);
            document.getElementById('secFilings').textContent = r.sec.totalFilings || 0;
            document.getElementById('fedregDocs').textContent = r.fedreg.totalDocs || 0;
            const score = Math.min(100, Math.round((r.google.averageScore || 0) * 0.15 + Math.min(r.reddit.totalPosts, 25) * 1.5 + Math.min(r.spending.totalAwards, 25) * 1.5 + Math.min(r.wiki.avgViews / 1000, 20) + Math.min(r.sec.totalFilings, 20) + Math.min(r.fedreg.totalDocs, 15)));
            document.getElementById('correlationScore').textContent = score;
            renderLine('googleChart', r.google.labels, r.google.data, '#4285f4', g => googleChart = g);
            renderBar('redditChart', r.reddit.monthlyData.labels, r.reddit.monthlyData.data, '#ff4500', g => redditChart = g);
            renderLine('spendingChart', r.spending.monthlySpending.labels, r.spending.monthlySpending.data, '#00d4aa', g => spendingChart = g, true);
            renderLine('wikiChart', r.wiki.dailyViews.labels, r.wiki.dailyViews.data, '#636466', g => wikiChart = g);
            renderBar('secChart', r.sec.monthlyFilings.labels, r.sec.monthlyFilings.data, '#f59e0b', g => secChart = g);
            renderBar('fedregChart', r.fedreg.monthlyDocs.labels, r.fedreg.monthlyDocs.data, '#8b5cf6', g => fedregChart = g);
            renderGoogleList(r.google.results);
            renderRedditList(r.reddit.posts);
            renderSpendingList(r.spending.awards);
            renderWikiList(r.wiki);
            renderSECList(r.sec.filings);
            renderFedRegList(r.fedreg.documents);
            generateInsights(keyword, r);
        }

        function renderLine(id, labels, data, color, setChart, isCurrency = false) {
            const ctx = document.getElementById(id).getContext('2d');
            const chart = new Chart(ctx, { type: 'line', data: { labels, datasets: [{ data, borderColor: color, backgroundColor: color + '20', fill: true, tension: 0.4, pointRadius: 0 }] }, options: chartOpts(isCurrency) });
            setChart(chart);
        }

        function renderBar(id, labels, data, color, setChart) {
            const ctx = document.getElementById(id).getContext('2d');
            const chart = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ data, backgroundColor: color + '99', borderColor: color, borderWidth: 1, borderRadius: 3 }] }, options: chartOpts(false) });
            setChart(chart);
        }

        function chartOpts(isCurrency) {
            return { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#555566', font: { size: 8 }, maxRotation: 45 } }, y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#555566', font: { size: 8 }, callback: isCurrency ? v => '$' + formatCur(v) : undefined } } } };
        }

        function renderGoogleList(items) { const c = document.getElementById('googleList'); if (!items?.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì∞</div><p>No results</p></div>'; return; } c.innerHTML = items.slice(0,8).map(i => `<div class="data-item"><div class="data-item-title"><a href="${i.link}" target="_blank">${esc(i.title)}</a></div><div class="data-item-meta">${esc(i.displayLink)}</div></div>`).join(''); }
        function renderRedditList(items) { const c = document.getElementById('redditList'); if (!items?.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí¨</div><p>No posts</p></div>'; return; } c.innerHTML = items.slice(0,8).map(i => `<div class="data-item"><div class="data-item-title"><a href="${i.url}" target="_blank">${esc(i.title)}</a></div><div class="data-item-meta">${i.subreddit} ‚¨ÜÔ∏è${formatNum(i.score)} üí¨${i.comments}</div></div>`).join(''); }
        function renderSpendingList(items) { const c = document.getElementById('spendingList'); if (!items?.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üèõÔ∏è</div><p>No contracts</p></div>'; return; } c.innerHTML = items.slice(0,8).map(i => `<div class="data-item"><div class="spending-amount">$${formatCur(i.amount||0)}</div><div style="font-size:0.8rem;color:var(--text-secondary)">${esc(i.recipient||'Unknown')}</div><div class="data-item-meta">${esc(i.agency||'N/A')}</div></div>`).join(''); }
        function renderWikiList(data) { const c = document.getElementById('wikiList'); if (!data.article) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìö</div><p>No article found</p></div>'; return; } c.innerHTML = `<div class="data-item"><div class="pageviews-count">${formatNum(data.totalViews)} total views</div><div class="data-item-title"><a href="https://en.wikipedia.org/wiki/${encodeURIComponent(data.article.replace(/ /g,'_'))}" target="_blank">${esc(data.article)}</a></div><div class="data-item-meta">~${formatNum(data.avgViews)} views/day</div></div>` + (data.related||[]).slice(1,4).map(a => `<div class="data-item"><div class="data-item-title"><a href="${a.url}" target="_blank">${esc(a.title)}</a></div></div>`).join(''); }
        function renderSECList(items) { const c = document.getElementById('secList'); if (!items?.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No filings</p></div>'; return; } c.innerHTML = items.slice(0,8).map(i => `<div class="data-item"><div class="data-item-title"><a href="${i.url}" target="_blank">${esc(i.company)}</a></div><div class="data-item-meta"><span style="color:var(--accent-sec)">${i.form}</span> üìÖ${i.date||'N/A'}</div></div>`).join(''); }
        function renderFedRegList(items) { const c = document.getElementById('fedregList'); if (!items?.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚öñÔ∏è</div><p>No documents</p></div>'; return; } c.innerHTML = items.slice(0,8).map(i => `<div class="data-item"><div class="data-item-title"><a href="${i.url}" target="_blank">${esc(i.title)}</a></div><div class="data-item-meta"><span style="color:var(--accent-fedreg)">${i.type||'Doc'}</span> üìÖ${i.date||'N/A'}</div></div>`).join(''); }

        function generateInsights(keyword, r) {
            const c = document.getElementById('insightsList'), ins = [];
            if (r.google.totalResults > 0) ins.push(`<div class="insight-item"><strong>News:</strong> ${r.google.totalResults.toLocaleString()} articles found for "${keyword}".</div>`);
            if (r.reddit.totalPosts > 0) { const subs = [...new Set(r.reddit.posts.map(p => p.subreddit))].slice(0,3).join(', '); ins.push(`<div class="insight-item"><strong>Social:</strong> ${r.reddit.totalPosts} Reddit posts, mainly in ${subs}.</div>`); }
            if (r.spending.totalAwards > 0) ins.push(`<div class="insight-item"><strong>Federal Spending:</strong> $${formatCur(r.spending.totalSpending)} across ${r.spending.totalAwards} contracts.</div>`);
            if (r.wiki.article) ins.push(`<div class="insight-item"><strong>Public Interest:</strong> "${r.wiki.article}" averages ${formatNum(r.wiki.avgViews)} daily Wikipedia views.</div>`);
            if (r.sec.totalFilings > 0) ins.push(`<div class="insight-item"><strong>Corporate:</strong> ${r.sec.totalFilings} SEC filings mention "${keyword}".</div>`);
            if (r.fedreg.totalDocs > 0) ins.push(`<div class="insight-item"><strong>Regulatory:</strong> ${r.fedreg.totalDocs} Federal Register documents.</div>`);
            const active = [r.google.totalResults>0, r.reddit.totalPosts>0, r.spending.totalAwards>0, r.wiki.article, r.sec.totalFilings>0, r.fedreg.totalDocs>0].filter(Boolean).length;
            if (active >= 4) ins.push(`<div class="insight-item"><strong>Cross-Platform:</strong> Strong presence across ${active}/6 sources - active topic in public, corporate & government sectors.</div>`);
            c.innerHTML = ins.length ? ins.join('') : '<p class="empty-state">No significant insights</p>';
        }

        function formatCur(n) { if (n >= 1e9) return (n/1e9).toFixed(1)+'B'; if (n >= 1e6) return (n/1e6).toFixed(1)+'M'; if (n >= 1e3) return (n/1e3).toFixed(1)+'K'; return n.toFixed(0); }
        function formatNum(n) { if (n >= 1e6) return (n/1e6).toFixed(1)+'M'; if (n >= 1e3) return (n/1e3).toFixed(1)+'K'; return n.toString(); }
        function esc(t) { if (!t) return ''; const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
        function showLoading(s) { loadingOverlay.classList.toggle('active', s); searchBtn.disabled = s; }
        function updateLoadingText(t) { loadingText.textContent = t; }
        function showError(m) { errorMessage.textContent = m; errorMessage.classList.add('active'); }
        function hideError() { errorMessage.classList.remove('active'); }
        searchInput.placeholder = 'Try: artificial intelligence, cybersecurity, renewable energy...';
    </script>
</body>
</html>